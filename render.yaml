# Unified Render.com deployment configuration
# Single backend service for all KVSHVL platform apps
# Deploy by connecting this repository to Render and pointing to this file
# Follows Render Blueprint specification: https://render.com/docs/blueprint-spec

services:
  # Unified Platform Backend API
  - type: web
    name: platform-api
    runtime: python
    buildCommand: pip install --upgrade pip && pip install -e ./packages/shared-backend && pip install -r ./apps/platform-api/requirements.txt
    startCommand: cd apps/platform-api && gunicorn main:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --timeout 120 --graceful-timeout 30 --access-logfile - --error-logfile -
    healthCheckPath: /health/ready
    envVars:
      # Python Path Configuration
      # Set to current directory (after 'cd apps/platform-api')
      # Allows absolute imports like 'from models.xxx import yyy' to work
      - key: PYTHONPATH
        value: "."
      
      # Application Configuration
      - key: PLATFORM_APP_NAME
        value: "KVSHVL Platform API"
      - key: PLATFORM_ENVIRONMENT
        value: "production"
      - key: PLATFORM_DEBUG
        value: "false"
      - key: PLATFORM_CORS_ORIGINS
        value: "https://kvshvl.in,https://www.kvshvl.in,https://sketch2bim.kvshvl.in"
      
      # Database Configuration (Shared Platform Database)
      # Shared database used by home site and sketch2bim
      - key: PLATFORM_DATABASE_URL
        sync: false
        # Shared platform database connection string
        # Format: postgresql://[USER]:[PASSWORD]@[HOST]:[PORT]/[DATABASE]
        # Get from: https://console.upstash.com/postgres
      
      # Upstash Redis (Shared)
      - key: PLATFORM_UPSTASH_REDIS_REST_URL
        sync: false
      - key: PLATFORM_UPSTASH_REDIS_REST_TOKEN
        sync: false
      
      # Razorpay Payment Gateway (Unified)
      - key: PLATFORM_RAZORPAY_KEY_ID
        sync: false
      - key: PLATFORM_RAZORPAY_KEY_SECRET
        sync: false
      - key: PLATFORM_RAZORPAY_WEBHOOK_SECRET
        sync: false
      - key: PLATFORM_RAZORPAY_PLAN_WEEKLY
        value: "plan_RpPWbi4QjNg3be"
      - key: PLATFORM_RAZORPAY_PLAN_MONTHLY
        value: "plan_RpPWcMzjryEIxp"
      - key: PLATFORM_RAZORPAY_PLAN_YEARLY
        value: "plan_RpPWcsVTseLwnQ"
      
      # Note: Sketch2BIM-specific environment variables removed
      # Sketch2BIM is now a separate repository with its own deployment
      
      # Supabase Configuration (replaces NextAuth/Google OAuth)
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      
      # Legacy Authentication (deprecated - kept for backward compatibility)
      - key: PLATFORM_NEXTAUTH_SECRET
        sync: false
      - key: PLATFORM_AUTH_SECRET
        sync: false
      
      # Admin Access
      - key: PLATFORM_ADMIN_EMAILS
        value: "writetokushaldsamant@gmail.com,kushaldsamant@gmail.com,samant.kushal@gmail.com,yourmailproject@gmail.com"

# Notes:
# - Platform backend service (home site)
# - Uses shared platform database (PLATFORM_DATABASE_URL)
# - Uses shared Upstash Redis for caching
# - Unified Razorpay configuration for subscriptions
# - Sketch2BIM is now a separate repository with its own deployment
# - All secrets use sync: false to prompt for values in Render Dashboard
