# Unified Render.com deployment configuration
# Single backend service for all KVSHVL platform apps
# Deploy by connecting this repository to Render and pointing to this file
# Follows Render Blueprint specification: https://render.com/docs/blueprint-spec

services:
  # Unified Platform Backend API
  - type: web
    name: platform-api
    runtime: python
    rootDir: apps/platform-api
    buildCommand: pip install --upgrade pip && pip install -e ./packages/shared-backend && pip install -r ./apps/platform-api/requirements.txt
    startCommand: cd apps/platform-api && uvicorn main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      # Application Configuration
      - key: PLATFORM_APP_NAME
        value: "KVSHVL Platform API"
      - key: PLATFORM_ENVIRONMENT
        value: "production"
      - key: PLATFORM_DEBUG
        value: "false"
      - key: PLATFORM_CORS_ORIGINS
        value: "https://kvshvl.in,https://www.kvshvl.in,https://ask.kvshvl.in,https://reframe.kvshvl.in,https://sketch2bim.kvshvl.in"
      
      # Database Configuration (Upstash Postgres)
      # Upstash Postgres uses separate databases (not schemas)
      # ASK and Sketch2BIM each have their own database connection strings
      - key: ASK_DATABASE_URL
        sync: false
        # Upstash Postgres connection string for ASK database
        # Format: postgresql://[USER]:[PASSWORD]@[HOST]:[PORT]/[DATABASE]
        # Get from: https://console.upstash.com/postgres
      - key: SKETCH2BIM_DATABASE_URL
        sync: false
        # Upstash Postgres connection string for Sketch2BIM database
        # Format: postgresql://[USER]:[PASSWORD]@[HOST]:[PORT]/[DATABASE]
        # Get from: https://console.upstash.com/postgres
      
      # Upstash Redis (Shared)
      - key: PLATFORM_UPSTASH_REDIS_REST_URL
        sync: false
      - key: PLATFORM_UPSTASH_REDIS_REST_TOKEN
        sync: false
      
      # Razorpay Payment Gateway (Unified)
      - key: PLATFORM_RAZORPAY_KEY_ID
        sync: false
      - key: PLATFORM_RAZORPAY_KEY_SECRET
        sync: false
      - key: PLATFORM_RAZORPAY_WEBHOOK_SECRET
        sync: false
      - key: PLATFORM_RAZORPAY_PLAN_WEEK
        value: "plan_Rha5Ikcm5JrGqx"
      - key: PLATFORM_RAZORPAY_PLAN_MONTH
        value: "plan_Rha5JNPsk1WmI6"
      - key: PLATFORM_RAZORPAY_PLAN_YEAR
        value: "plan_Rha5Jzn1sk8o1X"
      
      # App-specific environment variables (namespaced)
      # ASK Configuration
      - key: ASK_GROQ_API_KEY
        sync: false
      - key: ASK_GROQ_API_BASE
        value: "https://api.groq.com/openai/v1"
      - key: ASK_GROQ_MODEL
        value: "llama-3.1-70b-versatile"
      
      # Reframe Configuration
      - key: REFRAME_GROQ_API_KEY
        sync: false
      - key: REFRAME_FREE_LIMIT
        value: "5"
      
      # Sketch2BIM Configuration
      - key: SKETCH2BIM_GROQ_API_KEY
        sync: false
      - key: SKETCH2BIM_REPLICATE_API_KEY
        sync: false
      - key: SKETCH2BIM_REPLICATE_MODEL_ID
        value: "kushalsamant/sketch2bim-processor"
      - key: SKETCH2BIM_BUNNY_STORAGE_ZONE
        sync: false
      - key: SKETCH2BIM_BUNNY_ACCESS_KEY
        sync: false
      - key: SKETCH2BIM_BUNNY_CDN_HOSTNAME
        sync: false
      
      # Authentication
      - key: PLATFORM_NEXTAUTH_SECRET
        sync: false
      - key: PLATFORM_AUTH_SECRET
        sync: false
      
      # Admin Access
      - key: PLATFORM_ADMIN_EMAILS
        value: "writetokushaldsamant@gmail.com,kushaldsamant@gmail.com,samant.kushal@gmail.com,yourmailproject@gmail.com"

# Notes:
# - Single unified backend service replaces 3 separate services
# - Uses Upstash Postgres databases (separate databases for ASK and Sketch2BIM)
# - Uses shared Upstash Redis for caching
# - Unified Razorpay configuration for platform-wide subscriptions
# - App-specific env vars are namespaced (ASK_*, REFRAME_*, SKETCH2BIM_*)
# - All secrets use sync: false to prompt for values in Render Dashboard
